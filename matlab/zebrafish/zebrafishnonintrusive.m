load('phiprod')

axi1 = [-sqrt(3) -sqrt(3) -sqrt(3) 0 0 0 sqrt(3) sqrt(3) sqrt(3)]; 
axi2 = [-sqrt(3) 0 sqrt(3) -sqrt(3) 0 sqrt(3) -sqrt(3) 0 sqrt(3)];

lambda = [];
aphi0 = ones(length(axi1),1);
for i = 1:length(axi1)
    aphi1(i) = axi1(i);
    aphi2(i) = axi2(i);
    aphi3(i) = (axi1(i))^2 - 1;
    aphi4(i) = axi1(i)*axi2(i);
    aphi5(i) = (axi2(i))^2 - 1;
end
lambda = [aphi0 aphi1' aphi2' aphi3' aphi4' aphi5']; %construction of lambda matrix
pi = (((transpose(lambda))*lambda)^-1)*transpose(lambda); %construction of pi matrix
save('pi','pi')
Tp = .28*axi1 + 2.8;
Tm = 1.2*axi2 + 12;
a = 0.225;
% FIX THIS, AXI1 = TP, AXI2 = TM 
f1 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(1))*(x(1)-x(3)); (4/Tm(1))*(x(3)-x(4)); (4/Tm(1))*(x(4)-x(5)); (4/Tm(1))*(x(5)-x(6)); (4/Tp(1))*(x(2)-x(7)); (4/Tp(1))*(x(7)-x(8)); (4/Tp(1))*(x(8)-x(9)); (4/Tp(1))*(x(9)-x(10))]; 
f2 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(2))*(x(1)-x(3)); (4/Tm(2))*(x(3)-x(4)); (4/Tm(2))*(x(4)-x(5)); (4/Tm(2))*(x(5)-x(6)); (4/Tp(2))*(x(2)-x(7)); (4/Tp(2))*(x(7)-x(8)); (4/Tp(2))*(x(8)-x(9)); (4/Tp(2))*(x(9)-x(10))];
f3 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(3))*(x(1)-x(3)); (4/Tm(3))*(x(3)-x(4)); (4/Tm(3))*(x(4)-x(5)); (4/Tm(3))*(x(5)-x(6)); (4/Tp(3))*(x(2)-x(7)); (4/Tp(3))*(x(7)-x(8)); (4/Tp(3))*(x(8)-x(9)); (4/Tp(3))*(x(9)-x(10))]; 
f4 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(4))*(x(1)-x(3)); (4/Tm(4))*(x(3)-x(4)); (4/Tm(4))*(x(4)-x(5)); (4/Tm(4))*(x(5)-x(6)); (4/Tp(4))*(x(2)-x(7)); (4/Tp(4))*(x(7)-x(8)); (4/Tp(4))*(x(8)-x(9)); (4/Tp(4))*(x(9)-x(10))]; 
f5 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(5))*(x(1)-x(3)); (4/Tm(5))*(x(3)-x(4)); (4/Tm(5))*(x(4)-x(5)); (4/Tm(5))*(x(5)-x(6)); (4/Tp(5))*(x(2)-x(7)); (4/Tp(5))*(x(7)-x(8)); (4/Tp(5))*(x(8)-x(9)); (4/Tp(5))*(x(9)-x(10))];
f6 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(6))*(x(1)-x(3)); (4/Tm(6))*(x(3)-x(4)); (4/Tm(6))*(x(4)-x(5)); (4/Tm(6))*(x(5)-x(6)); (4/Tp(6))*(x(2)-x(7)); (4/Tp(6))*(x(7)-x(8)); (4/Tp(6))*(x(8)-x(9)); (4/Tp(6))*(x(9)-x(10))]; 
f7 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(7))*(x(1)-x(3)); (4/Tm(7))*(x(3)-x(4)); (4/Tm(7))*(x(4)-x(5)); (4/Tm(7))*(x(5)-x(6)); (4/Tp(7))*(x(2)-x(7)); (4/Tp(7))*(x(7)-x(8)); (4/Tp(7))*(x(8)-x(9)); (4/Tp(7))*(x(9)-x(10))]; 
f8 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(8))*(x(1)-x(3)); (4/Tm(8))*(x(3)-x(4)); (4/Tm(8))*(x(4)-x(5)); (4/Tm(8))*(x(5)-x(6)); (4/Tp(8))*(x(2)-x(7)); (4/Tp(8))*(x(7)-x(8)); (4/Tp(8))*(x(8)-x(9)); (4/Tp(8))*(x(9)-x(10))];
f9 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(9))*(x(1)-x(3)); (4/Tm(9))*(x(3)-x(4)); (4/Tm(9))*(x(4)-x(5)); (4/Tm(9))*(x(5)-x(6)); (4/Tp(9))*(x(2)-x(7)); (4/Tp(9))*(x(7)-x(8)); (4/Tp(9))*(x(8)-x(9)); (4/Tp(9))*(x(9)-x(10))]; 

% Tp = 2.8 + 3 + (0.01*2.8)*axi1;
% Tm = 12 + (12*0.01)*axi2;
% 
% f1 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(1))*(x(1)-x(3)); (4/Tm(1))*(x(3)-x(4)); (4/Tm(1))*(x(4)-x(5)); (4/Tm(1))*(x(5)-x(6)); (4/Tp(1))*(x(2)-x(7)); (4/Tp(1))*(x(7)-x(8)); (4/Tp(1))*(x(8)-x(9)); (4/Tp(1))*(x(9)-x(10))]; 
% f2 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(2))*(x(1)-x(3)); (4/Tm(2))*(x(3)-x(4)); (4/Tm(2))*(x(4)-x(5)); (4/Tm(2))*(x(5)-x(6)); (4/Tp(2))*(x(2)-x(7)); (4/Tp(2))*(x(7)-x(8)); (4/Tp(2))*(x(8)-x(9)); (4/Tp(2))*(x(9)-x(10))];
% f3 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(3))*(x(1)-x(3)); (4/Tm(3))*(x(3)-x(4)); (4/Tm(3))*(x(4)-x(5)); (4/Tm(3))*(x(5)-x(6)); (4/Tp(3))*(x(2)-x(7)); (4/Tp(3))*(x(7)-x(8)); (4/Tp(3))*(x(8)-x(9)); (4/Tp(3))*(x(9)-x(10))]; 
% f4 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(4))*(x(1)-x(3)); (4/Tm(4))*(x(3)-x(4)); (4/Tm(4))*(x(4)-x(5)); (4/Tm(4))*(x(5)-x(6)); (4/Tp(4))*(x(2)-x(7)); (4/Tp(4))*(x(7)-x(8)); (4/Tp(4))*(x(8)-x(9)); (4/Tp(4))*(x(9)-x(10))]; 
% f5 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(5))*(x(1)-x(3)); (4/Tm(5))*(x(3)-x(4)); (4/Tm(5))*(x(4)-x(5)); (4/Tm(5))*(x(5)-x(6)); (4/Tp(5))*(x(2)-x(7)); (4/Tp(5))*(x(7)-x(8)); (4/Tp(5))*(x(8)-x(9)); (4/Tp(5))*(x(9)-x(10))];
% f6 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(6))*(x(1)-x(3)); (4/Tm(6))*(x(3)-x(4)); (4/Tm(6))*(x(4)-x(5)); (4/Tm(6))*(x(5)-x(6)); (4/Tp(6))*(x(2)-x(7)); (4/Tp(6))*(x(7)-x(8)); (4/Tp(6))*(x(8)-x(9)); (4/Tp(6))*(x(9)-x(10))]; 
% f7 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(7))*(x(1)-x(3)); (4/Tm(7))*(x(3)-x(4)); (4/Tm(7))*(x(4)-x(5)); (4/Tm(7))*(x(5)-x(6)); (4/Tp(7))*(x(2)-x(7)); (4/Tp(7))*(x(7)-x(8)); (4/Tp(7))*(x(8)-x(9)); (4/Tp(7))*(x(9)-x(10))]; 
% f8 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(8))*(x(1)-x(3)); (4/Tm(8))*(x(3)-x(4)); (4/Tm(8))*(x(4)-x(5)); (4/Tm(8))*(x(5)-x(6)); (4/Tp(8))*(x(2)-x(7)); (4/Tp(8))*(x(7)-x(8)); (4/Tp(8))*(x(8)-x(9)); (4/Tp(8))*(x(9)-x(10))];
% f9 = @(t,x) [a*x(10) - 0.23*x(1); (33/(1 + (x(6).^2)/100)) - 0.23*x(2); (4/Tm(9))*(x(1)-x(3)); (4/Tm(9))*(x(3)-x(4)); (4/Tm(9))*(x(4)-x(5)); (4/Tm(9))*(x(5)-x(6)); (4/Tp(9))*(x(2)-x(7)); (4/Tp(9))*(x(7)-x(8)); (4/Tp(9))*(x(8)-x(9)); (4/Tp(9))*(x(9)-x(10))]; 

x0 = [10 1 0 0 0 0 0 0 0 0];
options = odeset('NonNegative', 1);
t = [0:0.01:1000];
[t,xzeb1] = ode45(f1,t,x0,options);
[t,xzeb2] = ode45(f2,t,x0,options);
[t,xzeb3] = ode45(f3,t,x0,options);
[t,xzeb4] = ode45(f4,t,x0,options);
[t,xzeb5] = ode45(f5,t,x0,options);
[t,xzeb6] = ode45(f6,t,x0,options);
[t,xzeb7] = ode45(f7,t,x0,options);
[t,xzeb8] = ode45(f8,t,x0,options);
[t,xzeb9] = ode45(f9,t,x0,options);

%For each xzeb function, p(t) is first column, m(t) is second, rest is time
%delay

xzeb = [xzeb1 xzeb2 xzeb3 xzeb4 xzeb5 xzeb6 xzeb7 xzeb8 xzeb9];

%Concatenate all into "master" matrix that contain corresponding values for
%each axi(i) input


xzeval1 = pi*[xzeb(:,1) xzeb(:,11) xzeb(:,21) xzeb(:,31) xzeb(:,41) xzeb(:,51) xzeb(:,61) xzeb(:,71) xzeb(:,81)]';
xzeval2 = pi*[xzeb(:,2) xzeb(:,12) xzeb(:,22) xzeb(:,32) xzeb(:,42) xzeb(:,52) xzeb(:,62) xzeb(:,72) xzeb(:,82)]';
%These two matrices are p(t) and m(t) for each axi(i) value, up to 9,
%multiplied by pi matrix, which gives final plots

x1znew = [xzeb(:,1) xzeb(:,11) xzeb(:,21) xzeb(:,31) xzeb(:,41) xzeb(:,51) xzeb(:,61) xzeb(:,71) xzeb(:,81)]';
x2znew = [xzeb(:,2) xzeb(:,12) xzeb(:,22) xzeb(:,32) xzeb(:,42) xzeb(:,52) xzeb(:,62) xzeb(:,72) xzeb(:,82)]';

save('x1znew','x1znew')
save('x2znew','x2znew')

figure
plot(t,xzeval1(1,:)); xlabel('Time'); ylabel('Expected Value');
%xlim([0 10])
hold on 
plot(t, xzeval2(1,:))
legend('p(t)','m(t)')
set(gca,'FontSize',15)

save('xzeval1','xzeval1')
save('xzeval2','xzeval2')




